<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ã‚£ãƒ™ãƒ¼ãƒˆè©³ç´° - {{ debate.title }}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: rgb(255, 140, 80);
            min-height: 100vh;
            padding: 40px 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .header h1 {
            color: rgb(255, 140, 80);
            margin-bottom: 15px;
            font-size: 2em;
        }
        .header-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .info-item {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid rgb(255, 140, 80);
        }
        .info-label {
            font-size: 0.9em;
            color: #999;
            margin-bottom: 5px;
        }
        .info-value {
            font-size: 1.1em;
            color: #333;
            font-weight: 600;
        }
        .content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        .content h2 {
            color: rgb(255, 140, 80);
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        .statements {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .statement {
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid;
        }
        .statement.user {
            background: #E3F2FD;
            border-color: rgb(100, 150, 200);
        }
        .statement.ai {
            background: #FFE0B2;
            border-color: rgb(255, 140, 80);
        }
        .statement-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .statement-speaker {
            font-weight: 600;
            font-size: 1.1em;
        }
        .statement.user .statement-speaker {
            color: rgb(100, 150, 200);
        }
        .statement.ai .statement-speaker {
            color: rgb(255, 140, 80);
        }
        .statement-order {
            background: rgba(0, 0, 0, 0.1);
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.9em;
        }
        .statement-text {
            color: #333;
            line-height: 1.8;
            font-size: 0.95em;
        }
        .result-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        .result-section h2 {
            color: rgb(255, 140, 80);
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        .winner-info {
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1.1em;
        }
        .winner-user {
            background: #FFB6C1;
            color: #8B0000;
        }
        .winner-ai {
            background: #87CEEB;
            color: #00008B;
        }
        .winner-draw {
            background: #DDA0DD;
            color: #333;
        }
        .judgment {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid rgb(255, 140, 80);
            line-height: 1.8;
            color: #333;
        }
        .actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .actions a,
        .actions button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 0.95em;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-back {
            background: rgb(100, 150, 200);
            color: white;
        }
        .btn-back:hover {
            background: rgb(80, 130, 180);
        }
        .btn-edit {
            background: rgb(255, 140, 80);
            color: white;
        }
        .btn-edit:hover {
            background: rgb(245, 130, 70);
        }
        .btn-delete {
            background: #FF6B6B;
            color: white;
        }
        .btn-delete:hover {
            background: #FF5252;
        }
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }
        @media (max-width: 768px) {
            .header-info {
                grid-template-columns: 1fr;
            }
            .header {
                padding: 20px;
            }
            .content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="header">
            <h1>ğŸ¤ ãƒ‡ã‚£ãƒ™ãƒ¼ãƒˆè©³ç´°</h1>
            <p style="color: #666; margin-bottom: 20px;">{{ debate.title }}</p>
            
            <div class="header-info">
                <div class="info-item">
                    <div class="info-label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div>
                    <div class="info-value">
                        {% if debate.status == 'setup' %}
                            âš™ï¸ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
                        {% elif debate.status == 'debating' %}
                            ğŸ¤ ãƒ‡ã‚£ãƒ™ãƒ¼ãƒˆä¸­
                        {% else %}
                            âœ… å®Œäº†
                        {% endif %}
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-label">AIã‚¿ã‚¤ãƒ—</div>
                    <div class="info-value">
                        {% if debate.ai_type == 'logical' %}
                            ğŸ§  è«–ç†çš„
                        {% elif debate.ai_type == 'creative' %}
                            ğŸ’¡ å‰µé€ çš„
                        {% elif debate.ai_type == 'diplomatic' %}
                            ğŸ¤ å¤–äº¤çš„
                        {% else %}
                            âš¡ æ”»æ’ƒçš„
                        {% endif %}
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-label">å…ˆæ”»</div>
                    <div class="info-value">
                        {% if debate.first_speaker == 'user' %}
                            ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
                        {% else %}
                            ğŸ¤– AI
                        {% endif %}
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-label">ä½œæˆæ—¥æ™‚</div>
                    <div class="info-value">{{ debate.created_at|date:"Y/m/d H:i" }}</div>
                </div>
            </div>
        </div>

        <!-- ç™ºè¨€ä¸€è¦§ -->
        {% if statements %}
            <div class="content">
                <h2>ğŸ’¬ ãƒ‡ã‚£ãƒ™ãƒ¼ãƒˆç™ºè¨€</h2>
                <div class="statements">
                    {% for statement in statements %}
                        <div class="statement {{ statement.speaker }}">
                            <div class="statement-header">
                                <div class="statement-speaker">
                                    {% if statement.speaker == 'user' %}
                                        ğŸ‘¤ ã‚ãªãŸã®æ„è¦‹
                                    {% else %}
                                        ğŸ¤– AIã®æ„è¦‹
                                    {% endif %}
                                </div>
                                <div class="statement-order">ç¬¬{{ statement.order }}ç™ºè¨€</div>
                            </div>
                            <div class="statement-text">{{ statement.text }}</div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% else %}
            <div class="content">
                <div class="empty-state">
                    <p>ã¾ã ç™ºè¨€ãŒã‚ã‚Šã¾ã›ã‚“</p>
                </div>
            </div>
        {% endif %}

        <!-- çµæœ -->
        {% if debate.status == 'completed' %}
            <div class="result-section">
                <h2>ğŸ† ãƒ‡ã‚£ãƒ™ãƒ¼ãƒˆçµæœ</h2>
                
                <div class="winner-info winner-{{ debate.winner }}">
                    {% if debate.winner == 'user' %}
                        ğŸ‘¤ <strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå‹åˆ©ã—ã¾ã—ãŸï¼</strong>
                    {% elif debate.winner == 'ai' %}
                        ğŸ¤– <strong>AIãŒå‹åˆ©ã—ã¾ã—ãŸï¼</strong>
                    {% else %}
                        ğŸ¤ <strong>å¼•ãåˆ†ã‘ã§ã™ï¼</strong>
                    {% endif %}
                </div>
                
                <div class="judgment">
                    <strong>ğŸ“‹ AIã®åˆ¤å®š:</strong><br>
                    {{ debate.judgment_text }}
                </div>
            </div>
        {% endif %}

        <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="actions">
            <a href="{% url 'debate_index' %}" class="btn-back">â† ãƒ‡ã‚£ãƒ™ãƒ¼ãƒˆä¸€è¦§ã¸</a>
            {% if debate.status != 'completed' %}
                <a href="{% url 'debate_room' debate.id %}" class="btn-edit">ğŸ“ ãƒ‡ã‚£ãƒ™ãƒ¼ãƒˆå†é–‹</a>
            {% endif %}
            <button class="btn-delete" onclick="deleteDebate()">ğŸ—‘ï¸ å‰Šé™¤</button>
        </div>
    </div>

    <script>
        const debateId = parseInt('{{ debate.id }}');

        function deleteDebate() {
            if (confirm('ã“ã®ãƒ‡ã‚£ãƒ™ãƒ¼ãƒˆã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
                fetch(`/debate/${debateId}/delete/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken'),
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        alert('ãƒ‡ã‚£ãƒ™ãƒ¼ãƒˆã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
                        window.location.href = '/debate/';
                    } else {
                        alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
                });
            }
        }

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>
</body>
</html>
